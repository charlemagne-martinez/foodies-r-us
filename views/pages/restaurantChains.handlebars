{{!-- /*
* Citation: Citation is from node.js starter code
* Date: 03/06/2024
* Adapted from: Github page
* Source: https://github.com/osu-cs340-ecampus/nodejs-starter-app
*/  --}}
{{>header}}
{{>navbar}}

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


<main>
	<h1>Restaurant Chains</h1>
	<div id="browse">
		<table id="chains-table" border="1" cellpadding="5">
			<thead>
				<tr>
					<th>ID</th>
					<th>Name</th>
					<th>Delete</th>
				</tr>
			</thead>
			<tbody>
				{{#each data}}
				<tr data-value="{{this.restaurantChainID}}">
					<td>{{this.restaurantChainID}}</td>
					<td>{{this.name}}</td>
					<td><button onclick="deleteChains({{this.restaurantChainID}})">Delete</button></td>
				</tr>
				{{/each}}
			</tbody>
		</table>
		<p>&nbsp;</p>
		{{!-- <script src="../../static/deleteRestaurantChains.js"></script> --}}
		<script>
			function deleteChains(restaurantChainID) 
			{
				console.log("deleteRestaurantChains.js is connected!");

				let link = '/delete-restaurant-chain';

				// Put our data we want to send in a javascript object
				let data = {
					restaurantChainID: restaurantChainID
				};

				$.ajax(
				{
					url: link,
					type: 'DELETE',
					data: JSON.stringify(data),
					contentType: "application/json; charset=utf-8",
					success: function(result)
					{
						deleteRow(restaurantChainID)
					} 
				});

			}

			function deleteRow(restaurantChainID)
			{
				let table = document.getElementById("chains-table");
				for (let i = 0, row; row = table.rows[i]; i++) 
				{
				// iterate through rows
				// rows would be accessed using the "row" variable assigned in the for loop
				if (table.rows[i].getAttribute("data-value") == restaurantChainID) 
				{
						table.deleteRow(i);
						break;
				}
				}
			}
		</script>

	</div> <!-- browse -->
	<p>&nbsp;</p>

	<div id="insert" style="display: block">
		<form id="add-chain-form" method="POST" action="/add-chain-form">
			<legend><strong>Add Restaurant Chain</strong></legend>
			<fieldset class="fields">
				<label> Restaurant Chain Name </label> 
				<input type="text" name="name" id="input-chain">
			</fieldset>

			<input class="btn" type="submit" id="addRestaurantChain" value="Add a Restaurant Chain">
			<input class="btn" type="button" value="Cancel">
		</form> <!--add new restaurantChain-->
	</div><!-- insert -->

	<p>&nbsp;</p>
	<div id="update" style="display: block">
		<form id="update-chain-form" method="POST" action="/update-chain-form">
			<legend><strong>Update Restaurant Chain</strong></legend>
			<fieldset class="fields">
				<label>Restaurant Chain</label> 
				<select id="select-chain">
					<option>Select a Chain</option>
					{{#each data}}
						<option data-name="{{this.name}}" data-chainID="{{this.restaurantChainID}}">
							{{this.name}}
						</option>
					{{/each}}
				</select>
				{{!-- second input --}}
				<label>New Restaurant Chain Name</label>
				<input type="text" name="name" id="update-name">
        		<input type="hidden" name="chainID" id="update-chainID">
			</fieldset>
			<input class="btn" type="submit" id="UpdateSaveRestaurantChain" value="Save Update Restaurant Chain">
			<input class="btn" type="button" value="Cancel" >
		</form> 
	</div><!-- update -->
	<p>&nbsp;</p>
	<script>
		let selectElement = document.querySelector('#select-chain');

		selectElement.addEventListener('change', function(e) {
			let selectedOption = selectElement.options[selectElement.selectedIndex];

			document.getElementById("update-chainID").value = selectedOption.getAttribute('data-chainID')
		});

	</script>

</main>